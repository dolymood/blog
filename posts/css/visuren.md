## CSS 可视化格式模型（Visual formatting model）

### 可视化格式模型简介

这一章以及下一章来描述可视化格式模型：用户代理针对于可视化媒介是怎样处理文档树的。

在可视化格式模型中，在文档树中的每一个元素会通过盒模型生成0个或者多个盒子。这些盒子的布局是这样管理的：

* 框的尺寸和类型。

* 定位体系（普通流、浮动float、和绝对定位）。

* 文档树中的元素之间的关系。

* 额外的信息（例如，viewport的大小、图片的固有尺寸等等）。

<!--more-->

本章以及下一章中定义的属性是应用在‘连续媒体’和‘分页媒体’上的。然而，当应用到分页媒体上的时候，margin属性的意义会有所不同。

可视化格式模型不会涉及格式化的所有细节（方面）。本规范中不包括那些符合规范的用户代理们的不同行为的那些格式化问题。

#### 视口 viewport

连续媒体的用户代理通常会提供给用户一个viewport，用户可以用来查阅文档。当viewport的大小发生改变的时候，用户代理可能会改变文档的布局。

当viewport比文档渲染您所需的画布区域小的时候，用户代理应该提供一个滚动条。每一个画布上最多有一个viewport，但是用户代理可以渲染多个画布。

#### 包含块

在CSS2.1中，很多的盒子的定位和尺寸的计算都取决于一个矩形的边界，这个矩形就是包含块。一般来说，生成的盒子扮演者他的子孙盒子的包含块的角色；我们称：一个盒子为他的子孙节点创建了包含块。

每一个盒子都相对于其包含块摆放，但是不会被包含块限制。他可能会溢出（overflow）。

在下一章中将会讨论包含块的细节。

### 控制盒子的产生

接下来的段落将会描述在CSS2.1中有的盒子类型。从部分角度来说，一个盒子的类型影响了他在可视化格式模型中的行为。下边所描述的display属性，决定了一个盒子的类型。

#### 块级元素（Block-leval elements）和块盒（block boxes）

块级元素是源文档中的那些被可视化格式化为盒状的元素。这些display属性可以使得一个元素是块级的： 'block', 'list-item' 和 'table'。

块级盒是在一个BFC（块级格式化上下文）中的盒子。每一个块级元素会生成一个包含着子孙盒子的主块级盒（主盒），并且生成内容且这个盒子会参与任何定位方案。一些块级元素除了主盒外可能还会生成额外的盒，例如：'list-item'元素。这些额外的框相对于主盒摆放。

除了table盒子（将会在后边的章节介绍）和替换元素，一个块级盒子一般也是一个块容器盒。一个块容器盒要么只包含块级盒，要么只包含创建了IFC（inline formatting context 行内级格式化上下文）的行内级盒。并不是所有的块容器盒就是块级盒：非替换的inline blocks和非替换的table cells是块容器，但是却不是块级盒。块级盒同样是块容器的就成为块级盒（块盒）。

这三个术语“块级框”，“块容器盒”和“块盒”有时会清晰的简称为“块”。

#### 匿名块盒

在一个像这样的文档中：

```html
<DIV>
  Some text
  <P>More text
</DIV>
```

(DIV和P的display都是block)，DIV中同时出现了行内内容和块内容。为了更容易的格式化，我们假定围绕着“Some text”有一个匿名块盒。

![匿名块盒](http://www.w3.org/TR/CSS21/images/anon-block.png)

换句话说：如果一个块容器盒里边有一个块级盒，那么我们强制其内部只有块级盒。

当一个行内盒包含着一个在普通流中的块级盒的时候，这个行内盒（和他的在相同线盒中的行内祖先们）会在块级盒周围断掉（和任何的连续的或者仅仅只是被空白white space和/ 或者不在普通流中的元素分开的同级块级兄弟们），被拆分成两个盒子（及时一边是空的），分别在块级盒的两边。这个线盒在断掉之前和之后的线框被匿名的块盒包着，并且这个块级盒成了那些匿名盒的兄弟。当这样的行内盒被相对定位影响到了，因此产生的任何换算也会影响包含在这个行内盒的块级盒。

_这种模式会被应用到下边的示例中：_

```css
p    { display: inline }
span { display: block }
```

且在HTML文档中是这样的：

```html
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HEAD>
<TITLE>Anonymous text interrupted by a block</TITLE>
</HEAD>
<BODY>
<P>
This is anonymous text before the SPAN.
<SPAN>This is the content of SPAN.</SPAN>
This is anonymous text after the SPAN.
</P>
</BODY>
```

_这个P元素包含着一个在一个块级元素之前的匿名文本区块C1和在其之后的匿名文本区块C2。结果上来看，BODY的块级盒，包含了一个围绕着C1的匿名块盒，SPAN块盒和另外一个围绕着C2的匿名块盒。_

匿名盒的属性是继承自最近的非匿名盒（例如之前的例子中的匿名块盒，他最近的非匿名盒就是DIV这个盒子）。非继承性的属性会有他们的初始值。例如，匿名盒的font就会继承自DIV，但是margin的值将会是0。

一个元素生设置了属性导致产生匿名块盒同样适用于其内容。例如，如果在上边的例子中，如果P元素设置了边框，那么border就会围绕着C1和C2绘制。

![示例结果](https://github.com/dolymood/blog/raw/master/pics/001.png)

匿名块盒在计算相对于他的百分比的值的时候会被忽略掉：利用最近的非匿名的父级（祖先）框替换。例如，上边的例子中，如果在DIV内的匿名块盒的孩子需要知道他的包含块的高height去计算一个百分比的高的话，那么他就会使用由DIV格式化出的包含块的高而不是匿名块盒的。

#### 行内级元素和行内盒


